# PRD: 정통 사주 기반 운세 시스템

> **Product Requirements Document**
> Version: 1.0
> Author: PM + 명리학 전문가
> Date: 2026-02-22
> Status: Draft

---

## 1. Executive Summary

### 1.1 현재 상태 (AS-IS)

현재 운세 엔진은 `SHA-256(userId + date)` 해시 기반으로, **사용자의 생년월일시와 무관한** 랜덤 점수(1~100)를 생성한다. 사주 명리학과의 관련성이 전혀 없어, "점집" 플랫폼으로서의 신뢰도와 재방문 동기가 약하다.

### 1.2 목표 상태 (TO-BE)

회원가입 시 **생년월일 + 태어난 시간(시주)** 을 필수 수집하고, **정통 사주팔자(四柱八字) 명리학**을 기반으로 만세력을 산출하여 개인화된 운세를 제공한다. 이를 통해:

- 전문성과 차별화된 콘텐츠로 **유료 상담 전환율(CVR)** 증대
- 일일 재방문율(DAU/MAU) 향상 (포스텔러: DAU 120만+)
- 상담사와의 자연스러운 연결 ("이 부분, 전문 상담사에게 더 깊이 물어보세요")

### 1.3 성공 지표 (KPI)

| 지표 | 현재 | 목표 (3개월) |
|------|------|-------------|
| 운세 페이지 DAU | - | 전체 DAU의 60%+ |
| 운세 → 상담 예약 전환율 | - | 5%+ |
| 회원가입 시 생년월일시 입력 완료율 | 0% (선택) | 85%+ |
| 운세 콘텐츠 공유율 | 0% | 3%+ |

---

## 2. 벤치마킹 분석

### 2.1 주요 경쟁 서비스

| 서비스 | 입력 정보 | 핵심 기능 | 수익 모델 | 강점 |
|--------|----------|----------|----------|------|
| **포스텔러** | 생년월일시, 성별, 양/음력 | 만세력, 사주풀이, 신년운세, 궁합, 타로 | 포인트(포스) 결제 → 유료 리포트 (연매출 100억+) | 차트/도표 시각화, 2300+ 콘텐츠 |
| **점신** | 생년월일시, 성별 | 오늘의 운세, AI+사주 융합, 감정 흐름 분석 | 광고 기반 + 행운패스 + 상담사 연결 | AI 해석, 상담사 마켓플레이스 |
| **신운세** | 생년월일시, 성별 | 프리미엄 운세 7종, 액막이, 운세부스터 | 구독형 (연간 무제한) | 깊이 있는 풀이, 액막이 문화 요소 |
| **네이트 운세** | 생년월일 | 신년운세, 토정비결, 띠별 운세 | 광고 | 접근성 (포털 내장) |
| **신한라이프 운세** | 생년월일 | 토정비결, 사주풀이, 궁합 | 보험사 마케팅 | 무료, 신뢰감 |

### 2.2 벤치마킹 인사이트

**공통 필수 입력**: 모든 서비스가 **생년월일 + 태어난 시간 + 성별 + 양/음력 구분**을 수집

**UX 패턴**:
- 포스텔러: 온보딩에서 생년월일시를 **필수**로 받음 (스킵 불가)
- 점신: 앱 최초 실행 시 "내 정보 입력" 화면에서 수집
- 대부분 **시간을 모를 경우** "모름" 옵션을 제공 → 시주 제외하고 삼주(三柱)로 해석

**차별화 포인트 (우리 서비스에 적용)**:
- 운세 결과에서 **"전문 상담사에게 더 깊이 물어보기"** CTA → 상담 예약 연결 (점신 모델)
- 무료 기본 운세 + **상담사만의 심층 사주 풀이** (유료 상담 차별화)

### 2.3 포지셔닝

```
[무료/가벼움] ←――――――――→ [유료/전문]

네이트 운세  ──  점신  ──  ★우리★  ──  포스텔러
(광고기반)      (광고+상담)  (상담연결)    (콘텐츠과금)
```

**우리의 포지셔닝**: 정통 사주 기반 무료 운세로 유입 → 전문 상담사 연결로 수익화

---

## 3. 사주 명리학 도메인 설계

### 3.1 사주팔자(四柱八字) 기본 구조

사주(四柱)란 **4개의 기둥** = 년주(年柱) + 월주(月柱) + 일주(日柱) + 시주(時柱)
팔자(八字)란 **8개의 글자** = 각 기둥마다 천간(天干) 1자 + 지지(地支) 1자

```
         년주    월주    일주    시주
천간(天干)  甲      丙      壬      庚
지지(地支)  子      寅      午      申
```

### 3.2 천간(天干) - 10개

| 순서 | 한자 | 한글 | 오행 | 음양 |
|------|------|------|------|------|
| 1 | 甲 | 갑 | 목(木) | 양(+) |
| 2 | 乙 | 을 | 목(木) | 음(-) |
| 3 | 丙 | 병 | 화(火) | 양(+) |
| 4 | 丁 | 정 | 화(Fire) | 음(-) |
| 5 | 戊 | 무 | 토(土) | 양(+) |
| 6 | 己 | 기 | 토(土) | 음(-) |
| 7 | 庚 | 경 | 금(金) | 양(+) |
| 8 | 辛 | 신 | 금(金) | 음(-) |
| 9 | 壬 | 임 | 수(水) | 양(+) |
| 10 | 癸 | 계 | 수(水) | 음(-) |

### 3.3 지지(地支) - 12개

| 순서 | 한자 | 한글 | 띠 | 오행 | 음양 | 시간대 |
|------|------|------|-----|------|------|--------|
| 1 | 子 | 자 | 쥐 | 수 | 양 | 23:30~01:30 |
| 2 | 丑 | 축 | 소 | 토 | 음 | 01:30~03:30 |
| 3 | 寅 | 인 | 호랑이 | 목 | 양 | 03:30~05:30 |
| 4 | 卯 | 묘 | 토끼 | 목 | 음 | 05:30~07:30 |
| 5 | 辰 | 진 | 용 | 토 | 양 | 07:30~09:30 |
| 6 | 巳 | 사 | 뱀 | 화 | 음 | 09:30~11:30 |
| 7 | 午 | 오 | 말 | 화 | 양 | 11:30~13:30 |
| 8 | 未 | 미 | 양 | 토 | 음 | 13:30~15:30 |
| 9 | 申 | 신 | 원숭이 | 금 | 양 | 15:30~17:30 |
| 10 | 酉 | 유 | 닭 | 금 | 음 | 17:30~19:30 |
| 11 | 戌 | 술 | 개 | 토 | 양 | 19:30~21:30 |
| 12 | 亥 | 해 | 돼지 | 수 | 음 | 21:30~23:30 |

> **참고**: 시간대는 한국 표준시(KST, UTC+9) 기준이며, 실제 경도(동경 127도)와의 약 30분 차이를 반영한 보정 시간표. 사주학에서는 이를 "진태양시 보정"이라 함.

### 3.4 오행(五行) 상생·상극

```
상생(相生): 목→화→토→금→수→목 (순환)
상극(相克): 목→토→수→화→금→목 (순환)
```

| 관계 | 설명 |
|------|------|
| 목생화(木生火) | 나무가 타서 불을 만듦 |
| 화생토(火生土) | 불이 타면 재(흙)가 됨 |
| 토생금(土生金) | 흙 속에서 금속이 나옴 |
| 금생수(金生水) | 금속 표면에 물방울이 맺힘 |
| 수생목(水生木) | 물이 나무를 자라게 함 |

### 3.5 사주 산출 알고리즘

#### 3.5.1 년주(年柱) 세우기

- **기준**: 양력 날짜를 음력으로 변환 후, **입춘(立春)** 기준으로 년주 결정
- **입춘 이전 출생**: 전년도 년주 적용
- **천간**: `(양력년도 - 3) % 10` → 천간 인덱스
- **지지**: `(양력년도 - 3) % 12` → 지지 인덱스

#### 3.5.2 월주(月柱) 세우기

- **기준**: 24절기의 **절기(節氣)** 기준 (월의 시작 = 절기)
- **절기 표**: 한국천문연구원 발표 데이터 기반

| 월 | 절기 | 지지 |
|----|------|------|
| 1월 | 입춘(立春) | 寅 |
| 2월 | 경칩(驚蟄) | 卯 |
| 3월 | 청명(清明) | 辰 |
| 4월 | 입하(立夏) | 巳 |
| 5월 | 망종(芒種) | 午 |
| 6월 | 소서(小暑) | 未 |
| 7월 | 입추(立秋) | 申 |
| 8월 | 백로(白露) | 酉 |
| 9월 | 한로(寒露) | 戌 |
| 10월 | 입동(立冬) | 亥 |
| 11월 | 대설(大雪) | 子 |
| 12월 | 소한(小寒) | 丑 |

- **월간(月干)**: 년간(年干)에 따라 **오호결원법(五虎遁元法)** 적용

| 년간 | 1월(인) 시작 천간 |
|------|------------------|
| 갑/기 | 병(丙) |
| 을/경 | 무(戊) |
| 병/신 | 경(庚) |
| 정/임 | 임(壬) |
| 무/계 | 갑(甲) |

#### 3.5.3 일주(日柱) 세우기

- **기준**: 만세력 DB 조회 (역산 불가 → 미리 계산된 데이터 필요)
- **일진**: 고유 값으로 60갑자 주기가 날짜와 무관하게 순환
- **데이터 소스**: 한국천문연구원 or 공개 만세력 데이터

#### 3.5.4 시주(時柱) 세우기

- **지지**: 출생 시간을 12시진으로 변환 (위 3.3 시간대 표 참조)
- **천간**: 일간(日干)에 따라 **오자결원법(五子遁元法)** 적용

| 일간 | 자시(子) 시작 천간 |
|------|------------------|
| 갑/기 | 갑(甲) |
| 을/경 | 병(丙) |
| 병/신 | 무(戊) |
| 정/임 | 경(庚) |
| 무/계 | 임(壬) |

- **시주 공식**:
```
dx = (dayGanIndex > 5) ? dayGanIndex - 5 : dayGanIndex
hourGanIndex = (hourJijiIndex + ((dx - 1) * 2))
if (hourGanIndex > 10) hourGanIndex -= 10
```

### 3.6 오늘의 운세 산출 로직

**핵심 원리**: 오늘의 일진(日辰) 천간·지지와 사용자의 사주팔자 간의 **상호작용**을 분석

#### 3.6.1 일간(日干) 기준 해석

사주에서 **일간(日柱의 천간)** = "나 자신"을 대표

| 분석 항목 | 산출 방법 |
|-----------|----------|
| **총운** | 오늘 일진과 내 일간의 오행 관계 (상생/상극/비화) |
| **재물운** | 오늘 일진과 내 사주 내 재성(偏財/正財)의 관계 |
| **애정운** | 오늘 일진과 내 사주 내 관성(偏官/正官) 또는 인성의 관계 |
| **건강운** | 오늘 일진의 오행이 내 사주의 약한 오행을 충(沖)하는지 |
| **사업운** | 오늘 일진과 내 사주 내 식신/상관의 활성 여부 |

#### 3.6.2 십성(十星/十神) 체계

일간을 기준으로 다른 7글자와의 관계를 **10가지 유형**으로 분류:

| 십성 | 관계 | 의미 | 운세 영역 |
|------|------|------|----------|
| 비견(比肩) | 같은 오행·같은 음양 | 경쟁, 자립 | 대인관계 |
| 겁재(劫財) | 같은 오행·다른 음양 | 손재, 분쟁 | 재물 주의 |
| 식신(食神) | 내가 생하는·같은 음양 | 재능, 표현 | 사업/학업 |
| 상관(傷官) | 내가 생하는·다른 음양 | 창의, 반항 | 관계 변동 |
| 편재(偏財) | 내가 극하는·같은 음양 | 투자, 횡재 | 재물 |
| 정재(正財) | 내가 극하는·다른 음양 | 안정 수입 | 재물 |
| 편관(偏官) | 나를 극하는·같은 음양 | 권위, 압박 | 직장/건강 |
| 정관(正官) | 나를 극하는·다른 음양 | 명예, 규율 | 직장/사회 |
| 편인(偏印) | 나를 생하는·같은 음양 | 학문, 변화 | 학업/정신 |
| 정인(正印) | 나를 생하는·다른 음양 | 지원, 안정 | 문서/학업 |

#### 3.6.3 12운성(十二運星)

일간이 오늘의 지지를 만났을 때의 **에너지 상태**:

| 운성 | 상태 | 점수 가중치 | 해석 키워드 |
|------|------|-----------|-----------|
| 장생(長生) | 탄생 | +8 | 새 시작, 활력 |
| 목욕(沐浴) | 성장 | +3 | 변화, 유혹 주의 |
| 관대(冠帶) | 성년 | +7 | 자신감, 발전 |
| 건록(乾祿) | 전성기 | +9 | 왕성한 활동 |
| 제왕(帝旺) | 정점 | +10 | 최고점, 과욕 주의 |
| 쇠(衰) | 하강 | -2 | 안정 추구, 무리 금지 |
| 병(病) | 약화 | -5 | 건강 관리 |
| 사(死) | 정지 | -7 | 전환기, 내면 성찰 |
| 묘(墓) | 수장 | -4 | 정리, 축적 |
| 절(絶) | 소멸 | -8 | 큰 변화, 위기=기회 |
| 태(胎) | 잉태 | +2 | 준비, 계획 |
| 양(養) | 양육 | +5 | 성장 준비, 학습 |

#### 3.6.4 합충형파해(合沖刑破害) - 길흉 판단

오늘 일진의 지지와 내 사주 지지 사이의 관계:

| 관계 | 의미 | 운세 영향 |
|------|------|----------|
| **삼합(三合)** | 같은 오행 3지지가 모임 | 대길, 큰 행운 |
| **육합(六合)** | 2지지가 합 | 길, 좋은 만남 |
| **충(沖)** | 정반대 지지 충돌 | 변동, 이동, 사고 주의 |
| **형(刑)** | 형벌의 관계 | 구설, 시비, 법적 문제 |
| **파(破)** | 깨뜨리는 관계 | 계획 차질 |
| **해(害)** | 해치는 관계 | 배신, 손해 |

#### 3.6.5 최종 점수 산출 공식

```
총운 점수 = 기본점(50)
  + 12운성 가중치
  + 십성 관계 보너스 (상생 +15, 비화 +5, 상극 -10)
  + 합충형파해 보정 (삼합 +20, 육합 +10, 충 -15, 형 -10, 파 -8, 해 -5)
  + 대운/세운 보정 (±5)

최종 점수 = clamp(총운 점수, 1, 100)
```

각 카테고리(재물운, 애정운, 건강운, 사업운)는 해당 십성의 활성 여부에 따라 별도 산출.

---

## 4. 기능 요구사항

### 4.1 회원가입 정보 수집 (Step 2 확장)

#### 4.1.1 필수 입력 필드

| 필드 | 타입 | 검증 | 비고 |
|------|------|------|------|
| 생년 | Select (1940~2010) | 필수 | 양력 기준 |
| 생월 | Select (1~12) | 필수 | |
| 생일 | Select (1~31) | 필수 | 월별 일수 동적 제한 |
| 태어난 시간 | Select (12시진) | 필수 ("모름" 허용) | 아래 옵션 참조 |
| 성별 | Radio (남/여) | 필수 | 대운 순행/역행 결정에 필요 |
| 양력/음력 | Toggle | 필수 (기본값: 양력) | 음력→양력 변환 필요 |

#### 4.1.2 태어난 시간 선택 옵션

사주 앱 벤치마킹 결과, 시간을 **12시진(時辰)** 단위로 수집하는 것이 표준:

| 옵션 | 시간대 | 한자 |
|------|--------|------|
| 자시 (쥐) | 23:30 ~ 01:30 | 子時 |
| 축시 (소) | 01:30 ~ 03:30 | 丑時 |
| 인시 (호랑이) | 03:30 ~ 05:30 | 寅時 |
| 묘시 (토끼) | 05:30 ~ 07:30 | 卯時 |
| 진시 (용) | 07:30 ~ 09:30 | 辰時 |
| 사시 (뱀) | 09:30 ~ 11:30 | 巳時 |
| 오시 (말) | 11:30 ~ 13:30 | 午時 |
| 미시 (양) | 13:30 ~ 15:30 | 未時 |
| 신시 (원숭이) | 15:30 ~ 17:30 | 申時 |
| 유시 (닭) | 17:30 ~ 19:30 | 酉時 |
| 술시 (개) | 19:30 ~ 21:30 | 戌時 |
| 해시 (돼지) | 21:30 ~ 23:30 | 亥時 |
| **모름** | - | - |

> "모름" 선택 시: 시주를 제외한 **삼주(三柱)** 기반 해석. 운세 결과에 "태어난 시간을 입력하면 더 정확한 운세를 볼 수 있어요" 안내 배너 표시.

#### 4.1.3 UX 흐름

```
Step 1: 기본 정보 (이메일, 비밀번호, 이름)     ← 현행 유지
Step 2: 사주 정보 (생년월일, 시간, 성별, 양/음력)  ← 확장
Step 3: 연락처 (전화번호)                      ← 선택
Step 4: 약관 동의                             ← 현행 유지
```

Step 2 변경 사항:
- 생년월일: 기존 선택 → **필수** 전환
- 태어난 시간: **신규 추가** (12시진 셀렉트)
- 양력/음력 토글: **신규 추가** (기본값: 양력)
- 성별: 기존 선택 → **필수** 전환 ("선택 안함" 제거)
- 화면 상단에 "정확한 운세를 위해 태어난 정보를 입력해주세요" 안내 문구

### 4.2 만세력 엔진 (Backend)

#### 4.2.1 핵심 컴포넌트

```
fortune/
  saju/
    SajuCalculator.java          ← 사주팔자 산출 메인 엔진
    ManseryeokData.java          ← 만세력 데이터 (일진 DB)
    CheonganEnum.java            ← 천간 10개 Enum
    JijiEnum.java                ← 지지 12개 Enum
    OhaengEnum.java              ← 오행 5개 Enum
    SipseongEnum.java            ← 십성 10개 Enum
    TwelveUnseongEnum.java       ← 12운성 Enum
    SajuPillar.java              ← 기둥 1개 (천간+지지) VO
    SajuChart.java               ← 사주 4기둥 완성 VO
    SolarLunarConverter.java     ← 양력↔음력 변환
    JeolgiData.java              ← 24절기 절입 시간 데이터
    DailyFortuneCalculator.java  ← 오늘의 운세 산출
```

#### 4.2.2 만세력 데이터 전략

**Option A: DB 기반 (권장)**

`manseryeok` 테이블에 1940-01-01 ~ 2030-12-31 (약 33,000행) 사전 계산 저장:

```sql
CREATE TABLE manseryeok (
    solar_date DATE PRIMARY KEY,
    lunar_year INT,
    lunar_month INT,
    lunar_day INT,
    is_leap_month BOOLEAN,
    day_gan_index INT,       -- 일간 인덱스 (1~10)
    day_ji_index INT,        -- 일지 인덱스 (1~12)
    jeolgi_name VARCHAR(20), -- 해당일 절기 (null if none)
    jeolgi_time TIME         -- 절기 절입 시각
);
```

**데이터 소스**: 한국천문연구원 공개 데이터 또는 검증된 만세력 라이브러리 활용

**Option B: 계산 기반**

천문학적 알고리즘으로 실시간 계산. 정확도 검증이 어렵고, 절기 절입 시각의 미세한 오차가 사주 결과를 뒤바꿀 수 있어 비권장.

#### 4.2.3 사주 산출 API

```
POST /api/v1/saju/chart
Request: { birthDate, birthHour, gender, calendarType }
Response: {
  yearPillar: { gan: "갑", ji: "자", ganHanja: "甲", jiHanja: "子" },
  monthPillar: { gan: "병", ji: "인", ... },
  dayPillar: { gan: "임", ji: "오", ... },
  hourPillar: { gan: "경", ji: "신", ... },  // null if birthHour = "unknown"
  ohaengBalance: { 목: 2, 화: 3, 토: 1, 금: 1, 수: 1 },
  dominantElement: "화",
  weakElement: "토"
}
```

### 4.3 오늘의 운세 (개선)

#### 4.3.1 운세 카테고리 확장

| 카테고리 | AS-IS | TO-BE |
|---------|-------|-------|
| 총운 | O | O (사주 기반) |
| 재물운 | O | O (편재/정재 분석) |
| 애정운 | O | O (관성/인성 분석) |
| 건강운 | O | O (오행 균형 분석) |
| 사업운 | X | **신규** (식신/상관 분석) |
| 학업운 | X | **신규** (인성 분석) |

#### 4.3.2 운세 응답 구조 (확장)

```json
{
  "fortuneDate": "2026-02-22",
  "dailyPillar": {
    "gan": "병",
    "ji": "인",
    "ohaeng": "화"
  },
  "myDayGan": "임",
  "relationship": "상극 (수극화)",
  "twelveUnseong": "장생",
  "categories": {
    "overall": {
      "score": 72,
      "grade": "좋음",
      "title": "새로운 시작의 에너지가 넘치는 하루",
      "description": "일간 임수(壬水)가 오늘 일진 병화(丙火)와 만나 편관의 기운이 활성화됩니다. 적극적인 자세로 도전하면 좋은 결과를 얻을 수 있습니다.",
      "advice": "오전 중 중요한 결정을 내리세요. 오후에는 에너지가 다소 떨어질 수 있습니다."
    },
    "wealth": { "score": 65, "grade": "보통", ... },
    "love": { "score": 78, "grade": "좋음", ... },
    "health": { "score": 58, "grade": "보통", ... },
    "career": { "score": 82, "grade": "매우좋음", ... }
  },
  "luckyColor": "빨강",
  "luckyNumber": 3,
  "luckyDirection": "남쪽",
  "luckyTime": "사시 (09:30~11:30)",
  "warningTime": "해시 (21:30~23:30)",
  "sajuInsight": "오늘은 편관이 강하게 작용하여 리더십을 발휘하기 좋은 날입니다. 다만 과한 욕심은 금물.",
  "counselorCta": {
    "show": true,
    "message": "오늘 편관 기운이 강합니다. 전문 상담사에게 올해의 관운(官運)을 더 깊이 알아보세요.",
    "category": "career"
  }
}
```

#### 4.3.3 운세 텍스트 생성 전략

**Phase 1 (MVP)**: 십성 × 12운성 × 합충 조합별 **사전 작성 템플릿** (약 300~500개)

```
[일간: 임수] + [오늘: 병화] = [편관] + [12운성: 장생]
→ "편관이 장생을 만나 새로운 도전에서 좋은 결과를 기대할 수 있습니다."
```

**Phase 2 (확장)**: LLM 기반 동적 운세 텍스트 생성
- 사주 분석 데이터를 프롬프트로 전달하여 자연스러운 한국어 운세 문장 생성
- 상담사 톤앤매너 커스터마이징 가능

### 4.4 사주 명식(命式) 조회 페이지

회원이 본인의 사주팔자를 상시 확인할 수 있는 전용 페이지:

#### 4.4.1 표시 정보

- **사주 4기둥** 시각화 (한자 + 한글 + 오행 색상)
- **오행 분포 차트** (목/화/토/금/수 비율 도넛차트)
- **일간 해석** ("당신은 임수(壬水)로, 큰 바다와 같은 포용력을 가진 사람입니다")
- **용신(用神) 안내** ("부족한 토(土) 기운을 보완하면 좋습니다")
- **띠/별자리** 표시
- **대운(大運) 흐름** 간략 표시

#### 4.4.2 오행 색상 체계

| 오행 | 색상 | HEX |
|------|------|-----|
| 목(木) | 청록 | `#2E8B57` |
| 화(火) | 적색 | `#DC143C` |
| 토(土) | 황색 | `#DAA520` |
| 금(金) | 백색/은색 | `#C0C0C0` |
| 수(水) | 흑색/남색 | `#191970` |

---

## 5. 데이터 모델 변경

### 5.1 UserEntity 확장

```java
// 기존 필드 유지 + 신규 추가
@Column(name = "birth_hour", length = 10)
private String birthHour;          // "자시", "축시", ... , "해시", "unknown"

@Column(name = "calendar_type", length = 10)
private String calendarType;       // "solar" (양력, default) or "lunar" (음력)

@Column(name = "is_leap_month")
private Boolean isLeapMonth;       // 음력인 경우 윤달 여부
```

### 5.2 신규 테이블

#### 5.2.1 manseryeok (만세력 데이터)

```sql
CREATE TABLE manseryeok (
    solar_date DATE NOT NULL PRIMARY KEY,
    lunar_year INT NOT NULL,
    lunar_month INT NOT NULL,
    lunar_day INT NOT NULL,
    is_leap_month BOOLEAN DEFAULT FALSE,
    day_gan_index INT NOT NULL,
    day_ji_index INT NOT NULL,
    jeolgi_code VARCHAR(20),
    jeolgi_time TIME,
    INDEX idx_lunar (lunar_year, lunar_month, lunar_day)
);
```

#### 5.2.2 saju_charts (사주 명식 캐시)

```sql
CREATE TABLE saju_charts (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL UNIQUE,
    birth_solar_date DATE NOT NULL,
    birth_hour VARCHAR(10),
    gender VARCHAR(10) NOT NULL,
    year_gan INT NOT NULL,
    year_ji INT NOT NULL,
    month_gan INT NOT NULL,
    month_ji INT NOT NULL,
    day_gan INT NOT NULL,
    day_ji INT NOT NULL,
    hour_gan INT,
    hour_ji INT,
    ohaeng_wood INT DEFAULT 0,
    ohaeng_fire INT DEFAULT 0,
    ohaeng_earth INT DEFAULT 0,
    ohaeng_metal INT DEFAULT 0,
    ohaeng_water INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

#### 5.2.3 daily_fortunes 확장

```sql
ALTER TABLE daily_fortunes
    ADD COLUMN daily_gan_index INT,
    ADD COLUMN daily_ji_index INT,
    ADD COLUMN twelve_unseong VARCHAR(20),
    ADD COLUMN sipseong VARCHAR(20),
    ADD COLUMN harmony_type VARCHAR(20),
    ADD COLUMN career_score INT,
    ADD COLUMN career_text VARCHAR(500),
    ADD COLUMN study_score INT,
    ADD COLUMN study_text VARCHAR(500),
    ADD COLUMN lucky_time VARCHAR(50),
    ADD COLUMN warning_time VARCHAR(50),
    ADD COLUMN saju_insight VARCHAR(500),
    ADD COLUMN counselor_cta_message VARCHAR(300);
```

---

## 6. API 변경

### 6.1 회원가입 DTO 변경

```java
public record SignupRequest(
    @NotBlank @Email String email,
    @NotBlank @Size(min = 8) String password,
    @NotBlank String name,
    @NotBlank String birthDate,           // 필수로 변경
    @NotBlank String birthHour,           // 신규: "자시"~"해시" 또는 "unknown"
    @NotBlank String gender,              // 필수로 변경: "male" / "female"
    String calendarType,                  // "solar" (default) / "lunar"
    Boolean isLeapMonth,                  // 음력+윤달인 경우만
    String phone,
    Boolean termsAgreed,
    String deviceId,
    String deviceName
) {}
```

### 6.2 신규 API 엔드포인트

| Method | Path | 설명 |
|--------|------|------|
| GET | `/api/v1/saju/my-chart` | 내 사주 명식 조회 |
| PUT | `/api/v1/saju/birth-info` | 생년월일시 수정 (사주 재계산) |
| GET | `/api/v1/fortune/today` | 오늘의 운세 (사주 기반, 기존 경로 유지) |
| GET | `/api/v1/fortune/monthly` | 이달의 운세 (신규) |
| GET | `/api/v1/fortune/yearly` | 올해의 운세 (신규) |

### 6.3 기존 API 하위호환

- `GET /api/v1/fortune/today` — 응답 구조가 확장되지만, 기존 필드(`overallScore`, `wealthScore`, `loveScore`, `healthScore`, 텍스트, 럭키아이템)는 모두 유지
- 사주 정보 미입력 사용자 → 기존 SHA-256 로직 폴백 (점진적 마이그레이션)

---

## 7. 프론트엔드 변경

### 7.1 회원가입 Step 2 리디자인

```
┌─────────────────────────────────────┐
│  정확한 운세를 위해                    │
│  태어난 정보를 입력해주세요 ✨           │
│                                     │
│  생년월일 *                           │
│  ┌──────┐ ┌────┐ ┌────┐             │
│  │ 1990 │ │ 3  │ │ 15 │             │
│  └──────┘ └────┘ └────┘             │
│                                     │
│  ○ 양력 (기본)  ○ 음력  □ 윤달       │
│                                     │
│  태어난 시간 *                        │
│  ┌──────────────────────────┐       │
│  │ 오시 (말) 11:30~13:30    ▼│       │
│  └──────────────────────────┘       │
│  ℹ️ 모르시면 "모름"을 선택하세요        │
│                                     │
│  성별 *                              │
│  ○ 남성  ○ 여성                      │
│                                     │
│  전화번호 (선택)                      │
│  ┌──────────────────────────┐       │
│  │ 010-0000-0000            │       │
│  └──────────────────────────┘       │
│                                     │
│  ┌────────┐  ┌────────────────┐     │
│  │  이전   │  │     다음       │     │
│  └────────┘  └────────────────┘     │
└─────────────────────────────────────┘
```

### 7.2 운세 결과 페이지 리디자인

```
┌─────────────────────────────────────┐
│  2026년 2월 22일 (병인일)             │
│  오늘의 운세                          │
│                                     │
│  ┌─────────────────────────────┐    │
│  │  오늘의 일진: 丙寅 (병인)       │    │
│  │  당신의 일간: 壬水 (임수)       │    │
│  │  관계: 편관 (偏官) + 장생       │    │
│  └─────────────────────────────┘    │
│                                     │
│       ╭──────╮                      │
│      ╱  72점  ╲    총운              │
│     │  ●●●●○  │    좋음              │
│      ╲       ╱                      │
│       ╰──────╯                      │
│                                     │
│  "편관이 장생을 만나 새로운 도전에서     │
│   좋은 결과를 기대할 수 있습니다..."    │
│                                     │
│  ┌────────────────────────────┐     │
│  │ 💰 재물운  65  ████████░░  │     │
│  │ 💕 애정운  78  ██████████░ │     │
│  │ 💪 건강운  58  ███████░░░  │     │
│  │ 💼 사업운  82  ██████████░ │     │
│  │ 📚 학업운  70  █████████░░ │     │
│  └────────────────────────────┘     │
│                                     │
│  ┌ 오행 균형 ─────────────────┐     │
│  │  木 ██░░░  火 ████░  土 █░ │     │
│  │  金 ██░░░  水 ███░░        │     │
│  └────────────────────────────┘     │
│                                     │
│  🍀 행운의 시간: 사시 (09:30~11:30)  │
│  🎨 행운의 색: 빨강                   │
│  🔢 행운의 숫자: 3                    │
│  🧭 행운의 방향: 남쪽                  │
│  ⚠️ 주의 시간: 해시 (21:30~23:30)    │
│                                     │
│  ┌─────────────────────────────┐    │
│  │ 💬 오늘 편관 기운이 강합니다.   │    │
│  │ 전문 상담사에게 올해의 관운을    │    │
│  │ 더 깊이 알아보세요.            │    │
│  │         [상담 예약하기]         │    │
│  └─────────────────────────────┘    │
└─────────────────────────────────────┘
```

### 7.3 사주 명식 페이지 (신규)

경로: `/my-saju`

```
┌─────────────────────────────────────┐
│  나의 사주 명식 (命式)                │
│                                     │
│  ┌──────┬──────┬──────┬──────┐     │
│  │ 시주  │ 일주  │ 월주  │ 년주  │     │
│  │ 庚    │ 壬    │ 丙    │ 甲    │     │
│  │ 경    │ 임    │ 병    │ 갑    │     │
│  │ [金]  │ [水]  │ [火]  │ [木]  │     │
│  ├──────┼──────┼──────┼──────┤     │
│  │ 申    │ 午    │ 寅    │ 子    │     │
│  │ 신    │ 오    │ 인    │ 자    │     │
│  │ [金]  │ [火]  │ [木]  │ [水]  │     │
│  │ 원숭이 │ 말   │ 호랑이│ 쥐    │     │
│  └──────┴──────┴──────┴──────┘     │
│                                     │
│  ┌ 오행 분포 ─────────────────┐     │
│  │      木 ██ (25%)            │     │
│  │      火 ██ (25%)            │     │
│  │      土 ░░ (0%)             │     │
│  │      金 ██ (25%)            │     │
│  │      水 ██ (25%)            │     │
│  └────────────────────────────┘     │
│                                     │
│  📝 일간 해석                        │
│  "당신은 壬水(임수)입니다.             │
│   큰 바다처럼 넓은 포용력과 지혜를      │
│   가지고 있으며..."                   │
│                                     │
│  💡 용신(用神): 토(土)                │
│  "부족한 토 기운을 보완하면             │
│   삶의 안정감을 높일 수 있습니다"       │
│                                     │
│  [전문 상담사에게 사주 풀이 받기]       │
└─────────────────────────────────────┘
```

---

## 8. 구현 로드맵

### Phase 1: 기반 구축 (Sprint 1-2, ~2주)

| # | 작업 | 우선순위 | 담당 |
|---|------|---------|------|
| 1.1 | 만세력 데이터 수집 및 DB 테이블 생성 (V54 마이그레이션) | P0 | Backend |
| 1.2 | 천간/지지/오행/십성 Enum 설계 | P0 | Backend |
| 1.3 | SajuCalculator 핵심 엔진 (년주/월주/일주/시주 산출) | P0 | Backend |
| 1.4 | 양력↔음력 변환기 | P0 | Backend |
| 1.5 | UserEntity 확장 (birthHour, calendarType) + 마이그레이션 | P0 | Backend |
| 1.6 | 사주 산출 단위 테스트 (검증된 만세력과 대조) | P0 | Backend |

### Phase 2: 운세 엔진 교체 (Sprint 3-4, ~2주)

| # | 작업 | 우선순위 | 담당 |
|---|------|---------|------|
| 2.1 | DailyFortuneCalculator (십성/12운성/합충 기반) | P0 | Backend |
| 2.2 | 운세 텍스트 템플릿 작성 (300+ 조합) | P0 | Content |
| 2.3 | FortuneService 리팩토링 (사주 기반 + SHA-256 폴백) | P0 | Backend |
| 2.4 | `/api/v1/saju/my-chart` API | P1 | Backend |
| 2.5 | daily_fortunes 테이블 확장 마이그레이션 | P0 | Backend |
| 2.6 | 통합 테스트 | P0 | Backend |

### Phase 3: 프론트엔드 (Sprint 5-6, ~2주)

| # | 작업 | 우선순위 | 담당 |
|---|------|---------|------|
| 3.1 | 회원가입 Step 2 리디자인 (시간/양음력 필드 추가) | P0 | Frontend |
| 3.2 | 운세 결과 페이지 리디자인 (사주 정보 표시) | P0 | Frontend |
| 3.3 | 사주 명식 페이지 (`/my-saju`) | P1 | Frontend |
| 3.4 | Flutter 앱 회원가입 및 운세 화면 동기화 | P1 | Flutter |
| 3.5 | 상담 예약 CTA 연동 | P0 | Frontend |

### Phase 4: 확장 (Sprint 7+)

| # | 작업 | 우선순위 |
|---|------|---------|
| 4.1 | 월간/연간 운세 | P2 |
| 4.2 | 궁합 기능 (2인 사주 비교) | P2 |
| 4.3 | LLM 기반 동적 운세 텍스트 생성 | P2 |
| 4.4 | 대운(大運) 흐름 시각화 | P3 |
| 4.5 | SNS 공유 카드 (운세 결과 이미지 생성) | P3 |

---

## 9. 기술적 고려사항

### 9.1 만세력 데이터 정확도

- **반드시** 검증된 만세력과 교차 검증 (포스텔러, 척척만세력 등)
- 절기 절입 시각은 **분 단위**까지 정확해야 함 (절기 경계 출생자 사주가 바뀜)
- 서머타임(1948~1961 한국 시행) 반영 필요

### 9.2 성능

- 사주 명식은 **최초 1회 계산 후 DB 캐시** (saju_charts 테이블)
- 오늘의 운세도 **일 1회 생성 후 캐시** (기존 패턴 유지)
- 만세력 테이블은 읽기 전용 → 캐시 히트율 높음

### 9.3 하위 호환

- 기존 사용자 (birthHour 미입력) → SHA-256 폴백 또는 삼주 기반 해석
- 기존 fortune API 응답의 기존 필드는 **절대 삭제하지 않음**
- 신규 필드는 추가만 (additive change)

### 9.4 개인정보 보호

- 생년월일시 = 개인정보 → 개인정보처리방침 업데이트 필요
- 수집 목적: "운세 서비스 제공" 명시
- 암호화 저장 고려 (birthDate는 현재 평문, birthHour도 동일하게 처리)

---

## 10. 리스크 및 대응

| 리스크 | 영향도 | 대응 |
|--------|-------|------|
| 만세력 데이터 오류 | High | 3개 이상 만세력 사이트와 교차 검증 자동화 테스트 |
| 회원가입 이탈율 증가 (필수 필드 증가) | Medium | "모름" 옵션 제공, 스킵 후 나중에 입력 가능하도록 |
| 사주 해석 정확도 논란 | Medium | "참고용 콘텐츠" 면책 문구, 전문 상담사 연결로 보완 |
| 운세 텍스트 다양성 부족 | Medium | Phase 2에서 LLM 도입으로 해결 |
| 기존 사용자 migration | Low | 폴백 로직으로 무중단 전환 |

---

## 11. References

- [포스텔러 - 신년운세, 사주, 타로](https://en.forceteller.com/)
- [점신 - 사주, 타로, 상담](https://play.google.com/store/apps/details?id=handasoft.mobile.divination)
- [신운세 - 사주, 운세의 모든 것](https://www.sinunse.com/)
- [사주 만세력 JAVA 백엔드 개발 시리즈](https://rgbitcode.com/blog/senspond/44)
- [사주팔자 - 나무위키](https://namu.wiki/w/%EC%82%AC%EC%A3%BC%ED%8C%94%EC%9E%90)
- [척척만세력](https://sajuplus.com/cheokcheok-calendar)
- [포스텔러 만세력](https://pro.forceteller.com/)
- [신한라이프 운세](https://shinhanlife.sinbiun.com/unse/saju/saju.php?unse_code=A104)
- [MZ세대 AI 사주 트렌드](https://www.kmjournal.net/news/articleView.html?idxno=8593)
- [포스텔러 연매출 100억 돌파 기사](https://zdnet.co.kr/view/?no=20250203104315)
